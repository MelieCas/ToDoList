@page "/todo"
@using ToDoList.DTO
@inject LocalStorageAccessor LocalStorageAccessor

<PageTitle>Todo</PageTitle>

<h1>Todo</h1>
    @foreach(TodoTask task in tasks) {
        <p><input type="checkbox" @bind="task.IsCompleted" @onclick="SaveAsync" /> @task</p>
    }
<input type="text" @bind=TaskText/>
<button class="btn btn-primary" @onclick="AddTaskAsync">Add</button>

@code {
    private List<TodoTask> tasks = new();
    private string? TaskText {get; set;}

    private async Task SaveAsync() {
        // ESTO TA FEO, NO HACER
        await Task.Delay(1);
        await LocalStorageAccessor.SetValueAsync<List<TodoTask>>("todos", tasks);
    }

    protected override async Task OnAfterRenderAsync(bool firstRender) {
        if (firstRender) 
        {
            tasks = await Http.GetFromJsonAsync<List<TodoTask>>("https://localhost:7209/api/TodoItems")
            StateHasChanged();
        }
        
    }
    private async Task AddTaskAsync()
    {
        tasks.Add(new TodoTask{Name = TaskText});
        await LocalStorageAccessor.SetValueAsync<List<TodoTask>>("todos", tasks);
        TaskText = "";
    }
}